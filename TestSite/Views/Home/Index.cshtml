@{
    ViewBag.Title = "Gav Corner";
}





<div class="row content-container">

    <div class="col-sm-6 col-xs-8" style="height: 500px;">
        <div class="row">
            <div class=" col-xs-12">
                <div class="input-group" style="width: 100%">
                    <p>
                        <input type="text" id="search-places" class="form-control" placeholder="What are you trying to Find" aria-describedby="basic-addon2">
                    </p>

                </div>
                <div id="demo"></div>
            </div>
        </div>

        <div id="map-canvas"></div>
    </div>
    <div class="col-sm-6 col-xs-4">

        <div class="row">


            <div class="col-sm-3 col-xs-12">
                <p>
                    <button type='button' value="gas_station" class='btn btn-block  btn-lg btn-success quick-search'>Gas</button>
                </p>
            </div>
            <div class="col-sm-3 col-xs-12">
                <p>
                    <button type='button' value="food" class='btn btn-block  btn-lg btn-success quick-search'>Food</button>
                </p>
            </div>
            <div class="col-sm-3 col-xs-12">
                <p>
                    <button type='button' value="laundry" class='btn btn-block btn-lg  btn-success quick-search'>Washing</button>
                </p>
            </div>
            <div class="col-sm-3 col-xs-12">
                <p>
                    <button type='button' value="grocery_or_supermarket" name="" class='btn btn-block  btn-lg btn-success quick-search'>SuperMarket</button>
                </p>
            </div>

        </div>

        <div class="row directions-block">
            <div class="col-xs-12">
                <p>
                    <button type='button' value="" class='btn btn-block  btn-lg btn-danger directions-back'>back to Results</button>
                </p>
            </div>
            <div id="directions-panel" class="col-xs-12">

            </div>
        </div>

        <div class="panel panel-default results" style="height: 500px;">
            <!-- Default panel contents -->
            <div class=" panel-heading">Results</div>
            <div class="panel-body">

            </div>
            <!-- List group -->
            <ul class="list-group result-list"></ul>
        </div>


    </div>

</div>
<div class="row">
    <div class="col-xs-12 google-logo">
        <img src="~/Content/Images/powered-by-google-on-white.png" />
    </div>
</div>








@section scripts
{
    <script>
        var x = document.getElementById("demo");


        var markers = [];

        var service;
        var map;
        var origin;
        var directionsService = new google.maps.DirectionsService();
        var directionsDisplay;

        function initialize() {

            directionsDisplay = new google.maps.DirectionsRenderer();

            var mapOptions = {

                zoom: 15
            };

            map = new google.maps.Map(document.getElementById('map-canvas'),
                mapOptions);

            if (navigator.geolocation) {
                getLocation();

            } else {
                // Browser doesn't support Geolocation
                handleNoGeolocation(false);
            }


            var marker = new google.maps.Marker({
                position: origin,
                map: map,

            });



            service = new google.maps.places.PlacesService(map);

            directionsDisplay.setMap(map);
            directionsDisplay.setPanel(document.getElementById('directions-panel'));


        }
        function getLocation() {
            navigator.geolocation.getCurrentPosition(function (position) {
                origin = new google.maps.LatLng(position.coords.latitude,
                                                 position.coords.longitude);

                var infowindow = new google.maps.InfoWindow({
                    map: map,
                    position: origin,
                    content: 'You are here.'
                });
                var myLocation = {
                    center: origin,
                    map: map,
                    radius: 20,
                    strokeColor: '#FF0000',
                    strokeOpacity: 0.8,
                    strokeWeight: 2,
                    fillColor: '#FF0000',
                    fillOpacity: 0.35,

                }

                var circle = new google.maps.Circle(myLocation);



                map.setCenter(origin);
            }, function () {
                handleNoGeolocation(true);
            });
        }
        function handleNoGeolocation(errorFlag) {
            if (errorFlag) {
                var content = 'Error: The Geolocation service failed.';
            } else {
                var content = 'Error: Your browser doesn\'t support geolocation.';
            }

            var options = {
                map: map,
                position: new google.maps.LatLng(60, 105),
                content: content
            };

            var infowindow = new google.maps.InfoWindow(options);
            map.setCenter(options.position);
        }

        google.maps.event.addDomListener(window, 'load', initialize);

        $('#search-places').keypress(function (e) {
            if (e.keyCode == 13) {
                emptyResultsList();
                clearMarkers();

                var search = $('#search-places').val();

                var request = {
                    location: origin,
                    rankBy: google.maps.places.RankBy.DISTANCE,
                    keyword: search,

                };



                //service.textSearch(request, callback);
                service.nearbySearch(request, callback);


            }
        });



        function callback(results, status) {

            if (status == google.maps.places.PlacesServiceStatus.OK) {
                for (var i = 0; i < results.length; i++) {

                    var place = results[i];
                    createMarker(place);
                    createResultList(place);
                }
            }
            else if (status == google.maps.places.PlacesServiceStatus.ZERO_RESULTS) {
                $(".result-list").append("<li> <h3> No Results Found </h3></li>");
            }
        }

        function createMarker(place) {

            var marker = new google.maps.Marker({
                position: place.geometry.location,
                map: map,
                title: place.name,

            });

            google.maps.event.addListener(marker, 'click', function () {

                getDirections(marker.getPosition());
            });

            markers.push(marker);

        }

        function emptyResultsList() {
            $(".result-list").empty();
        }

        function createResultList(place) {
            var li = document.createElement("li");
            var infoDiv = document.createElement("div");
            var buttonDiv = document.createElement("div");
            var rowDiv = document.createElement("div");
            var button = "<button type='button' value='" + place.geometry.location + "' class='btn btn-success result-button'>Get Directions</button>";

            li.appendChild(rowDiv);
            rowDiv.appendChild(infoDiv);
            rowDiv.appendChild(buttonDiv);

            li.setAttribute("class", "result-item list-group-item");
            rowDiv.setAttribute("class", "row");
            infoDiv.setAttribute("class", "place-info col-sm-8");
            buttonDiv.setAttribute("class", "button col-sm-4")

            var placeInfo = "<h3>" + place.name + "</h3><p>" + place.vicinity + "</p>";

            infoDiv.innerHTML = placeInfo;
            buttonDiv.innerHTML = button;

            $(".result-list").append(li);
        }

        $(document).on('click', '.result-list .btn', function () {
            // Your Code
            console.log(this.value);
            
            getDirections(this.value);

        });




        $(".directions-back").click(function () {

            $(".directions-block").hide();
            $(".results").show();

        });


        function clearMarkers() {
            for (var i = 0; i < markers.length; i++) {
                markers[i].setMap(null);
            }

        }

        function getDirections(location) {
            var start = origin;
            var end = location;

            var request = {
                origin: start,
                destination: end,
                travelMode: google.maps.TravelMode.DRIVING
            };

            directionsService.route(request, function (response, status) {
                if (status == google.maps.DirectionsStatus.OK) {
                    directionsDisplay.setDirections(response);
                }
            });

            $(".results").hide();
            $(".directions-block").show();

        }

        $(".quick-search").click(function () {

            var searchTypes = $(this).val();
            var names = $(this).attr("name");
            quickSearch(searchTypes, names);

        });

        function quickSearch(searchTypes, names) {
            emptyResultsList();
            clearMarkers();

            var types = searchTypes.split(",")
            //var search = $('#search-places').val();
            var request = {
                location: origin,
                rankBy: google.maps.places.RankBy.DISTANCE,
                name: names,
                types: types,
            };



            //service.textSearch(request, callback);
            service.nearbySearch(request, callback);

        }


    </script>
}